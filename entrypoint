#!/bin/bash

set -e

if [[ -d "docker-entrypoint.d" ]]
then
echo "Running docker-entrypoint.d files"
/bin/run-parts docker-entrypoint.d
fi

# Start Docker daemon and wait until it's responsive
exec "$@" &  # Start Docker daemon in background

# Wait for Docker socket to be ready
for i in {1..30}; do
  if docker info >/dev/null 2>&1; then
    echo "Docker is ready"
    break
  fi
  echo "Waiting for Docker to start... ($i/30)"
  sleep 1
done

# Now start the proxy
python3 /app/proxy.py